<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>جدول محاضرات رمضان</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

    :root{
      --bg:#f0f4f2;
      --card:#ffffff;
      --accent:#34624f;
      --gold:#d4af37;
      --friday:#cfe3d6;
      --header-col:#49876d;
      --first-col:#49876d;
    }

    html,body{
      margin:0;
      padding:1rem;
      font-family:'Amiri',serif;
      background:var(--bg);
    }

    .container{max-width:1000px;margin:auto}
    .card{
      background:#fff;
      border-radius:14px;
      padding:22px;
      border:4px solid var(--gold);
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:1rem;
    }

    th,td{
      border:1px solid #bdbdbd;
      text-align:center;
      vertical-align:middle;
    }

    thead th{
      background:var(--header-col);
      color:#fff;
    }

    tbody td:first-child{
      background:var(--first-col);
      color:#fff;
      font-weight:700;
    }

    tbody tr.friday{background:var(--friday)}
    td[contenteditable]{direction:rtl}

    #saveMessage{
      color:green;
      font-weight:bold;
      display:none;
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<div class="container">
  <div class="card">

    <h1>جدول محاضرات رمضان 1447</h1>

    <span id="saveMessage">تم الحفظ ✅</span>

    <table id="mainTable">
      <thead>
        <tr>
          <th>التاريخ</th>
          <th>الوقت</th>
          <th>اسم المحاضر</th>
          <th>رقم التواصل</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  </div>
</div>

<script>
/* Firebase */
firebase.initializeApp({
  apiKey:"AIzaSyCdhY4owQq8O6wgVOHcQQeaj2mrrwYr-j8",
  databaseURL:"https://ramadan-1447-default-rtdb.firebaseio.com"
});
const db = firebase.database();

const saveMessage = document.getElementById("saveMessage");
const tbody = document.querySelector("#mainTable tbody");

/* إنشاء الجدول */
const TOTAL_DAYS = 30;
const START_DATE = new Date(2026,1,19);
const weekdays = ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];

for(let i=1;i<=TOTAL_DAYS;i++){
  const tr=document.createElement("tr");
  const d=new Date(START_DATE);
  d.setDate(START_DATE.getDate()+i-1);

  const day=weekdays[d.getDay()];
  if(day==="الجمعة") tr.classList.add("friday");

  tr.innerHTML=`
    <td contenteditable>${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()} - ${day} - رمضان ${i}</td>
    <td>
      <select>
        ${(day==="الجمعة"
          ?["بعد صلاة الجمعة","بعد صلاة العصر","بعد صلاة المغرب","بعد صلاة العشاء"]
          :["بعد صلاة الظهر","بعد صلاة العصر","بعد صلاة المغرب","بعد صلاة العشاء"]
        ).map(v=>`<option>${v}</option>`).join("")}
      </select>
    </td>
    <td contenteditable></td>
    <td contenteditable></td>
  `;
  tbody.appendChild(tr);
}

/* حفظ */
tbody.addEventListener("input",()=>{
  const data=[...tbody.rows].map(r=>({
    date:r.cells[0].textContent,
    time:r.cells[1].querySelector("select").value,
    lecturer:r.cells[2].textContent,
    contact:r.cells[3].textContent
  }));
  db.ref("ramadan_lectures").set(data);
  saveMessage.style.display="inline";
  setTimeout(()=>saveMessage.style.display="none",1500);
});

/* تحميل */
db.ref("ramadan_lectures").on("value",s=>{
  const d=s.val();
  if(!d) return;
  [...tbody.rows].forEach((r,i)=>{
    if(!d[i]) return;
    r.cells[0].textContent=d[i].date;
    r.cells[1].querySelector("select").value=d[i].time;
    r.cells[2].textContent=d[i].lecturer;
    r.cells[3].textContent=d[i].contact;
  });
});
</script>

</body>
</html>

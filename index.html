<!doctype html>
<html lang="ar" dir="rtl"> 
  <head> <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>جدول محاضرات رمضان</title>
    <style> @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap'); 
      :root{
           --bg:#f0f4f2;
            --card:#ffffff;
            --accent:#34624f; 
            --gold:#d4af37; --muted:#6b705c; --friday:#cfe3d6;
            --header-col:#49876d; --first-col:#49876d; 
           } table td, table th {
        border: 1px solid #bdbdbd !important;
        /* فاصل واضح */ } td, th {
        text-align: center !important;
        vertical-align: middle !important;
      } html,
      body{ 
        margin:0; padding:1rem;
                   font-family:'Amiri', serif;
        background:var(--bg) 
          url('https://www.toptal.com/designers/subtlepatterns/uploads/moroccan-flower.png') repeat;
        background-size:300px; color:#000; } 
      .container{ max-width:1000px; margin:20px auto; padding:15px; }
      .card{ background:var(--card);
            border-radius:14px;
            padding:22px; 
            border:4px solid var(--gold); box-shadow:0 8px 24px rgba(0,0,0,0.08);
            position:relative; } 
      .card:before{ content:""; 
                   position:absolute;
                   top:-10px;
                   left:-10px;
                   right:-10px;
                   bottom:-10px;
                   border:3px solid var(--gold); border-radius:20px;
                   pointer-events:none; } h1::before{ content:""; 
                                                     display:block; width:140px; 
                                                     height:160px;
                                                     margin:0 auto 10px auto;
                                                     background:url('./img.png') center/contain no-repeat;
                                                    } h1,h2{ font-size:26px; 
                                                            text-align:center;
                                                            margin-bottom:15px; 
                                                            color:var(--accent);
                                                            font-weight:700;
                                                           }
      .table-wrapper{ width:100%; overflow-x:auto; margin-top:10px; }
      table{ width:100%; min-width:650px; border-collapse:collapse;
            font-size:18px; margin-top:1rem; background:#fff;
            border-radius:12px; overflow:hidden; border:2px solid #a9a9a9;
           } thead th{ background:var(--header-col); color:#fff; text-align:center; padding:0.5rem;
                      font-size:18px; border:1px solid #a9a9a9; }
      td[contenteditable="true"]
      { direction: rtl; unicode-bidi: plaintext;
       text-align: center !important;
       /* وسط أفقي */ vertical-align: middle !important;
       /* وسط عمودي */ }
      tbody tr:nth-child(odd){ background: rgba(245,245,245,0.7); 
                             } tbody tr:nth-child(even){ background:#ffffff; 
                                                       } tbody tr:hover{ background:#e0f0e8; }
      tbody td:first-child{ background:var(--first-col); color:#fff; font-weight:700; width:120px; }
      tbody tr.friday{ background-color:var(--friday) !important; 
                     } .card-header{ display:flex; justify-content:space-between; 
                                    align-items:center; flex-wrap:wrap; padding:12px 10px;
                                   } #saveBtn,#printBtn{ padding:10px 16px; border-radius:12px;
                                                        cursor:pointer; font-weight:bold; color:#fff; font-size:15px;
                                                        border:none; transition:0.2s;
                                                       } #saveBtn{ background:var(--gold);
                                                                 } #saveBtn:hover{ background:#c49b2c; 
                                                                                 } #printBtn{ background:var(--accent); margin-left:10px;
                                                                                            } #printBtn:hover{ background:#397155;
                                                                                                             } #saveMessage{ color:green; font-weight:bold; 
                                                                                                                            display:none; margin-right:8px; }
      .contact-box{ background:var(--card); 
                   padding:8px 15px;
                   border:2px solid var(--gold); border-radius:12px; 
                   text-align:center; 
                   color:var(--accent);
                   font-size:15px; line-height:1.6;
                  } @media print{
        body *{ visibility:hidden; 
              } #mainTable,#mainTable *{ visibility:visible; } #mainTable{ position:absolute; top:0; left:0; width:100%; 
                                                                         } }
    </style> 
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">
      
    </script> <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js">
      
 <script>
/* إعدادات Firebase */
const firebaseConfig={
  apiKey:"AIzaSyCdhY4owQq8O6wgVOHcQQeaj2mrrwYr-j8",
  authDomain:"ramadan-1447.firebaseapp.com",
  databaseURL:"https://ramadan-1447-default-rtdb.firebaseio.com",
  projectId:"ramadan-1447",
  storageBucket:"ramadan-1447.firebasestorage.app",
  messagingSenderId:"322777922760",
  appId:"1:322777922760:web:c20f28bfc04698dae039fd"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const saveMessage = document.getElementById("saveMessage");

/* إنشاء الجدول */
const TOTAL_DAYS = 30;
const START_DATE = new Date(2026, 1, 19);
const weekdays = ["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
const tbody = document.querySelector("#mainTable tbody");

for (let i = 1; i <= TOTAL_DAYS; i++) {
  const tr = document.createElement("tr");

  const date = new Date(START_DATE);
  date.setDate(START_DATE.getDate() + (i - 1));
  const weekdayName = weekdays[date.getDay()];

  if (weekdayName === "الجمعة") tr.classList.add("friday");

  /* التاريخ */
  const tdDate = document.createElement("td");
  tdDate.contentEditable = true;
  tdDate.textContent =
    `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()} - ${weekdayName} - رمضان ${i}`;
  tr.appendChild(tdDate);

  /* الوقت */
  const tdTime = document.createElement("td");
  const select = document.createElement("select");
  const opts = weekdayName === "الجمعة"
    ? ["بعد صلاة الجمعة","بعد صلاة العصر","بعد صلاة المغرب","بعد صلاة العشاء"]
    : ["بعد صلاة الظهر","بعد صلاة العصر","بعد صلاة المغرب","بعد صلاة العشاء"];
  opts.forEach(o=>{
    const op = document.createElement("option");
    op.value = o;
    op.textContent = o;
    select.appendChild(op);
  });
  tdTime.appendChild(select);
  tr.appendChild(tdTime);

  /* اسم المحاضر */
  const tdName = document.createElement("td");
  tdName.contentEditable = true;
  tr.appendChild(tdName);

  /* رقم التواصل */
  const tdPhone = document.createElement("td");
  tdPhone.contentEditable = true;
  tr.appendChild(tdPhone);

  tbody.appendChild(tr);
}

/* إصلاح اتجاه النص */
function placeCaretAtEnd(el){
  const range=document.createRange();
  const sel=window.getSelection();
  range.selectNodeContents(el);
  range.collapse(false);
  sel.removeAllRanges();
  sel.addRange(range);
}

document.addEventListener("focusin", e=>{
  if(e.target.matches('td[contenteditable="true"]')){
    e.target.setAttribute("dir","rtl");
    if(!e.target.textContent.startsWith("\u200F")){
      e.target.textContent="\u200F"+e.target.textContent;
      placeCaretAtEnd(e.target);
    }
  }
});

function clean(v){
  return v ? v.replace(/^\u200F/,"").trim() : "";
}

/* حفظ البيانات */
tbody.addEventListener("input", ()=>{
  const rows=[...tbody.querySelectorAll("tr")].map(tr=>{
    const tds=tr.querySelectorAll("td");
    return{
      date: clean(tds[0].textContent),
      time: tds[1].querySelector("select").value,
      lecturer: clean(tds[2].textContent),
      contact: clean(tds[3].textContent)
    }
  });

  db.ref("ramadan_lectures").set(rows);
  saveMessage.style.display="inline";
  setTimeout(()=>saveMessage.style.display="none",1500);
});

/* تحميل البيانات */
db.ref("ramadan_lectures").on("value", snap=>{
  const data=snap.val();
  if(!data) return;

  tbody.querySelectorAll("tr").forEach((tr,i)=>{
    if(!data[i]) return;
    const tds=tr.querySelectorAll("td");
    tds[0].textContent=data[i].date;
    tds[1].querySelector("select").value=data[i].time;
    tds[2].textContent=data[i].lecturer;
    tds[3].textContent=data[i].contact;
  });
});
</script>

  </body> 
</html>

